<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Using R for Introduction to Econometrics</title>
  <meta name="description" content="Using <tt>R</tt> for Introduction to Econometrics">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Using R for Introduction to Econometrics" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="Emwikts1970/URFITE-Bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Using R for Introduction to Econometrics" />
  
  
  

<meta name="author" content="Christoph Hanck, Martin Arnold, Alexander Gerber and Martin Schmelzer">


<meta name="date" content="2018-08-19">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="interactions-between-independent-variables.html">
<link rel="next" href="exercises.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- datacamp-light-latest -->

<!-- <script src="https://cdn.datacamp.com/datacamp-light-latest.min.js"></script> -->
<link rel='shortcut icon' type='image/x-icon' href='https://www.datacamp.com/assets/favicon.ico'/>
  <style>
    .exercise {
      margin: 50px;
    }
  </style>

  <script async src="https://cdn.datacamp.com/dcl-react-dev.js.gz"></script>

<script src="js/hideOutput.js"></script>
<script type="text/javascript" src="MathJax-2.7.2/MathJax.js?config=default"></script>

 <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js", "TeX/AMSmath.js"],
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
        jax: ["input/TeX","output/CommonHTML"]
      });
      MathJax.Hub.processSectionDelay = 0;
  </script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110299877-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110299877-1');
</script>

<!-- open review block -->

<script async defer src="https://hypothes.is/embed.js"></script>

<!-- <script src="js/d3.v3.min.js"></script>
<script src="js/leastsquares.js"></script>
<script src="js/d3functions.js"></script>
<script src="d3.slider.js"></script>
<script src="slrm.js"></script> -->

<style>
    .exercise {
      margin: 150px;
    }
</style>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">URFITE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="a-very-short-introduction-to-r-and-rstudio.html"><a href="a-very-short-introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>1.1</b> A Very Short Introduction to <tt>R</tt> and <em>RStudio</em></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="nrf.html"><a href="nrf.html"><i class="fa fa-check"></i><b>2</b> Nonlinear Regression Functions</a><ul>
<li class="chapter" data-level="2.1" data-path="a-general-strategy-for-modelling-nonlinear-regression-functions.html"><a href="a-general-strategy-for-modelling-nonlinear-regression-functions.html"><i class="fa fa-check"></i><b>2.1</b> A General Strategy for Modelling Nonlinear Regression Functions</a></li>
<li class="chapter" data-level="2.2" data-path="nfoasiv.html"><a href="nfoasiv.html"><i class="fa fa-check"></i><b>2.2</b> Nonlinear Functions of a Single Independent Variable</a><ul>
<li class="chapter" data-level="" data-path="nfoasiv.html"><a href="nfoasiv.html#polynomials"><i class="fa fa-check"></i>Polynomials</a></li>
<li class="chapter" data-level="" data-path="nfoasiv.html"><a href="nfoasiv.html#logarithms"><i class="fa fa-check"></i>Logarithms</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="interactions-between-independent-variables.html"><a href="interactions-between-independent-variables.html"><i class="fa fa-check"></i><b>2.3</b> Interactions Between Independent Variables</a></li>
<li class="chapter" data-level="2.4" data-path="nonlinear-effects-on-test-scores-of-the-student-teacher-ratio.html"><a href="nonlinear-effects-on-test-scores-of-the-student-teacher-ratio.html"><i class="fa fa-check"></i><b>2.4</b> Nonlinear Effects on Test Scores of the Student-Teacher Ratio</a></li>
<li class="chapter" data-level="2.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using <tt>R</tt> for Introduction to Econometrics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div class = rmdreview>
This book is in <b>Open Review</b>. We want your feedback to make the book better for you and other students. You may annotate some text by <span style="background-color: #3297FD; color: white">selecting it with the cursor</span> and then click the <i class="h-icon-annotate"></i> on the pop-up menu. You can also see the annotations of others: click the <i class="h-icon-chevron-left"></i> in the upper right hand corner of the page <i class="fa fa-arrow-circle-right  fa-rotate-315" aria-hidden="true"></i>
</div>
<div id="nonlinear-effects-on-test-scores-of-the-student-teacher-ratio" class="section level2">
<h2><span class="header-section-number">2.4</span> Nonlinear Effects on Test Scores of the Student-Teacher Ratio</h2>
<p>In this section we will discuss three specific questions about the relationship between test scores and the student-teacher ratio:</p>
<ol style="list-style-type: decimal">
<li><p>Does the effect on test scores of decreasing the student-teacher ratio depend on the fraction of English learners when we control for economic idiosyncrasies of the different districts?</p></li>
<li><p>Does this effect depend on the the student-teacher ratio?</p></li>
<li><p><em>How strong</em> is the effect of decreasing the student-teacher ratio (by two students per teacher) if we take into account economic characteristics and nonlinearities?</p></li>
</ol>
<p>Too answer these questions we consider a total of seven models, some of which are nonlinear regression specifications of the types that have been discussed before. As measures for the studentsâ€™ economic backgrounds, we additionally consider the regressors <span class="math inline">\(lunch\)</span> and <span class="math inline">\(\ln(income)\)</span>. We use the logarithm of <span class="math inline">\(income\)</span> because the analysis in Chapter <a href="nfoasiv.html#nfoasiv">2.2</a> showed that the nonlinear relationship between <span class="math inline">\(income\)</span> and <span class="math inline">\(TestScores\)</span> is approximately logarithmic. We do not include expenditure per pupil (<span class="math inline">\(expenditure\)</span>) because doing so would imply that expenditure varies with the student-teacher ratio (see Chapter 7.2 of the book for a detailed argument).</p>
<div id="nonlinear-regression-models-of-test-scores" class="section level4 unnumbered">
<h4>Nonlinear Regression Models of Test Scores</h4>
<p>The considered model specifications are:</p>
<span class="math display">\[\begin{align}
 TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_4 english_i + \beta_9 lunch_i + u_i \\
 TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_4 english_i + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_5 HiEL_i + \beta_6 (HiEL_i\times size_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_5 HiEL_i + \beta_6 (HiEL_i\times size_i) + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_2 size_i^2 + \beta_5 HiEL_i + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_2 size_i^2 + \beta_3 size_i^3 + \beta_5 HiEL_i + \beta_6 (HiEL\times size) \\  &amp;+ \beta_7 (HiEL_i\times size_i^2) + \beta_8 (HiEL_i\times size_i^3) + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_2 size_i^2 + \beta_3 size_i^3 + \beta_4 english + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i
\end{align}\]</span>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate all models</span>
TestScore_mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>english <span class="op">+</span><span class="st"> </span>lunch, <span class="dt">data =</span> CASchools)

TestScore_mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>english <span class="op">+</span><span class="st"> </span>lunch <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(income), <span class="dt">data =</span> CASchools)

TestScore_mod3 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>HiEL <span class="op">+</span><span class="st"> </span>HiEL<span class="op">:</span>size, <span class="dt">data =</span> CASchools)

TestScore_mod4 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>HiEL <span class="op">+</span><span class="st"> </span>HiEL<span class="op">:</span>size <span class="op">+</span><span class="st"> </span>lunch <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(income), 
    <span class="dt">data =</span> CASchools)

TestScore_mod5 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>HiEL <span class="op">+</span><span class="st"> </span>lunch <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(income), 
    <span class="dt">data =</span> CASchools)

TestScore_mod6 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>HiEL <span class="op">+</span><span class="st"> </span>HiEL<span class="op">:</span>size <span class="op">+</span><span class="st"> </span>
<span class="st">    </span>HiEL<span class="op">:</span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>HiEL<span class="op">:</span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>lunch <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(income), <span class="dt">data =</span> CASchools)

TestScore_mod7 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(size<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>english <span class="op">+</span><span class="st"> </span>lunch <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">log</span>(income), <span class="dt">data =</span> CASchools)</code></pre></div>
<p>We may use <tt>summary()</tt> to assess the modelsâ€™ fit. Using <tt>stargazer()</tt> we may also obtain a tabular representation of all regression outputs and which is more convenient for comparison of the models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># gather robust standard errors in a list</span>
rob_se &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(TestScore_mod1, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(TestScore_mod2, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(TestScore_mod3, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(TestScore_mod4, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(TestScore_mod5, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(TestScore_mod6, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(TestScore_mod7, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))))

<span class="co"># generate a LaTeX table of regression outputs</span>
<span class="kw">stargazer</span>(TestScore_mod1, 
          TestScore_mod2, 
          TestScore_mod3, 
          TestScore_mod4, 
          TestScore_mod5, 
          TestScore_mod6, 
          TestScore_mod7,
          <span class="dt">digits =</span> <span class="dv">3</span>,
          <span class="dt">dep.var.caption =</span> <span class="st">&quot;Dependent Variable: Test Score&quot;</span>,
          <span class="dt">se =</span> rob_se,
          <span class="dt">column.labels =</span> <span class="kw">c</span>(<span class="st">&quot;(1)&quot;</span>, <span class="st">&quot;(2)&quot;</span>, <span class="st">&quot;(3)&quot;</span>, <span class="st">&quot;(4)&quot;</span>, <span class="st">&quot;(5)&quot;</span>, <span class="st">&quot;(6)&quot;</span>, <span class="st">&quot;(7)&quot;</span>))</code></pre></div>



<table style="text-align:center"><tr><td colspan="8" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td colspan="7">Dependent Variable: Test Score</td></tr>
<tr><td></td><td colspan="7" style="border-bottom: 1px solid black"></td></tr>
<tr><td style="text-align:left"></td><td colspan="7">score</td></tr>
<tr><td style="text-align:left"></td><td>(1)</td><td>(2)</td><td>(3)</td><td>(4)</td><td>(5)</td><td>(6)</td><td>(7)</td></tr>
<tr><td colspan="8" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">size</td><td>-0.998<sup>***</sup></td><td>-0.734<sup>***</sup></td><td>-0.968</td><td>-0.531</td><td>64.339<sup>***</sup></td><td>83.702<sup>***</sup></td><td>65.285<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.270)</td><td>(0.257)</td><td>(0.589)</td><td>(0.342)</td><td>(24.861)</td><td>(28.497)</td><td>(25.259)</td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">english</td><td>-0.122<sup>***</sup></td><td>-0.176<sup>***</sup></td><td></td><td></td><td></td><td></td><td>-0.166<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.033)</td><td>(0.034)</td><td></td><td></td><td></td><td></td><td>(0.034)</td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">I(size2)</td><td></td><td></td><td></td><td></td><td>-3.424<sup>***</sup></td><td>-4.381<sup>***</sup></td><td>-3.466<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td>(1.250)</td><td>(1.441)</td><td>(1.271)</td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">I(size3)</td><td></td><td></td><td></td><td></td><td>0.059<sup>***</sup></td><td>0.075<sup>***</sup></td><td>0.060<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td>(0.021)</td><td>(0.024)</td><td>(0.021)</td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">lunch</td><td>-0.547<sup>***</sup></td><td>-0.398<sup>***</sup></td><td></td><td>-0.411<sup>***</sup></td><td>-0.420<sup>***</sup></td><td>-0.418<sup>***</sup></td><td>-0.402<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.024)</td><td>(0.033)</td><td></td><td>(0.029)</td><td>(0.029)</td><td>(0.029)</td><td>(0.033)</td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">log(income)</td><td></td><td>11.569<sup>***</sup></td><td></td><td>12.124<sup>***</sup></td><td>11.748<sup>***</sup></td><td>11.800<sup>***</sup></td><td>11.509<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td></td><td>(1.819)</td><td></td><td>(1.798)</td><td>(1.771)</td><td>(1.778)</td><td>(1.806)</td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">HiEL</td><td></td><td></td><td>5.639</td><td>5.498</td><td>-5.474<sup>***</sup></td><td>816.076<sup>**</sup></td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td>(19.515)</td><td>(9.795)</td><td>(1.034)</td><td>(327.674)</td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">size:HiEL</td><td></td><td></td><td>-1.277</td><td>-0.578</td><td></td><td>-123.282<sup>**</sup></td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td>(0.967)</td><td>(0.496)</td><td></td><td>(50.213)</td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">I(size2):HiEL</td><td></td><td></td><td></td><td></td><td></td><td>6.121<sup>**</sup></td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td>(2.542)</td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">I(size3):HiEL</td><td></td><td></td><td></td><td></td><td></td><td>-0.101<sup>**</sup></td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td>(0.043)</td><td></td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td style="text-align:left">Constant</td><td>700.150<sup>***</sup></td><td>658.552<sup>***</sup></td><td>682.246<sup>***</sup></td><td>653.666<sup>***</sup></td><td>252.050</td><td>122.353</td><td>244.809</td></tr>
<tr><td style="text-align:left"></td><td>(5.568)</td><td>(8.642)</td><td>(11.868)</td><td>(9.869)</td><td>(163.634)</td><td>(185.519)</td><td>(165.722)</td></tr>
<tr><td style="text-align:left"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td colspan="8" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>420</td><td>420</td><td>420</td><td>420</td><td>420</td><td>420</td><td>420</td></tr>
<tr><td style="text-align:left">R<sup>2</sup></td><td>0.775</td><td>0.796</td><td>0.310</td><td>0.797</td><td>0.801</td><td>0.803</td><td>0.801</td></tr>
<tr><td style="text-align:left">Adjusted R<sup>2</sup></td><td>0.773</td><td>0.794</td><td>0.305</td><td>0.795</td><td>0.798</td><td>0.799</td><td>0.798</td></tr>
<tr><td style="text-align:left">Residual Std. Error</td><td>9.080 (df = 416)</td><td>8.643 (df = 415)</td><td>15.880 (df = 416)</td><td>8.629 (df = 414)</td><td>8.559 (df = 413)</td><td>8.547 (df = 410)</td><td>8.568 (df = 413)</td></tr>
<tr><td style="text-align:left">F Statistic</td><td>476.306<sup>***</sup> (df = 3; 416)</td><td>405.359<sup>***</sup> (df = 4; 415)</td><td>62.399<sup>***</sup> (df = 3; 416)</td><td>325.803<sup>***</sup> (df = 5; 414)</td><td>277.212<sup>***</sup> (df = 6; 413)</td><td>185.777<sup>***</sup> (df = 9; 410)</td><td>276.515<sup>***</sup> (df = 6; 413)</td></tr>
<tr><td colspan="8" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td colspan="7" style="text-align:right"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>
</table>
<caption><p style='text-align:center'><span id="tab:nmots">Table 2.2: </span> Nonlinear Models of Test Scores</p></caption>


<p>Let us summarize what can be concluded from the results presented in Table <a href="nonlinear-effects-on-test-scores-of-the-student-teacher-ratio.html#tab:nmots">2.2</a>.</p>
<p>First of all, the coefficient on <span class="math inline">\(size\)</span> is statistically significant in all seven models. Adding <span class="math inline">\(\ln(income)\)</span> to model (1) we find that the corresponding coefficient is statistically significant at <span class="math inline">\(1\%\)</span> while all other coefficients remain at their significance level. Furthermore, the estimate for the coefficient on <span class="math inline">\(size\)</span> is roughly <span class="math inline">\(0.27\)</span> points larger, which may be a sign of attenuated omitted variable bias. We consider this a reason to include <span class="math inline">\(\ln(income)\)</span> as a regressor in other models, too.</p>
<p>Regressions (3) and (4) aim to assess the effect of allowing for an interaction between <span class="math inline">\(size\)</span> and <span class="math inline">\(HiEL\)</span>, without and with economic control variables. In both models, both the coefficient on the interaction term and the coefficient on the dummy are not statistically significant. Thus, even with economic controls we cannot reject the null hypotheses, that the effect of the student-teacher ratio on test scores is the same for districts with high and districts with low share of English learning students.</p>
<p>Regression (5) includes a cubic term for the student-teacher ratio and omits the interaction between <span class="math inline">\(size\)</span> and <span class="math inline">\(HiEl\)</span>. The results indicate that there is a nonlinear effect of the student-teacher ratio on test scores (Can you verify this using an <span class="math inline">\(F\)</span>-test of <span class="math inline">\(H_0: \beta_2=\beta_3=0\)</span>?)</p>
<p>Consequently, regression (6) further explores whether the fraction of English learners impacts the student-teacher ratio by using <span class="math inline">\(HiEL \times size\)</span> and the interactions <span class="math inline">\(HiEL \times size^2\)</span> and <span class="math inline">\(HiEL \times size^3\)</span>. All individual <span class="math inline">\(t\)</span>-tests indicate that that there are significant effects. We check this using a robust <span class="math inline">\(F\)</span>-test of <span class="math inline">\(H_0: \beta_6=\beta_7=\beta_8=0\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check joint significance of the interaction terms</span>
<span class="kw">linearHypothesis</span>(TestScore_mod6, 
                 <span class="kw">c</span>(<span class="st">&quot;size:HiEL=0&quot;</span>, <span class="st">&quot;I(size^2):HiEL=0&quot;</span>, <span class="st">&quot;I(size^3):HiEL=0&quot;</span>),
                 <span class="dt">vcov. =</span> <span class="kw">vcovHC</span>(TestScore_mod6, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))</code></pre></div>
<pre><code>## Linear hypothesis test
## 
## Hypothesis:
## size:HiEL = 0
## I(size^2):HiEL = 0
## I(size^3):HiEL = 0
## 
## Model 1: restricted model
## Model 2: score ~ size + I(size^2) + I(size^3) + HiEL + HiEL:size + HiEL:I(size^2) + 
##     HiEL:I(size^3) + lunch + log(income)
## 
## Note: Coefficient covariance matrix supplied.
## 
##   Res.Df Df      F  Pr(&gt;F)  
## 1    413                    
## 2    410  3 2.6903 0.04597 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We find that the null can be rejected at the level of <span class="math inline">\(5\%\)</span> and conclude that the regression function differs for districts with high and low percentage of English learners.</p>
<p>Specification (7) uses a continuous measure for the share of English learners instead of a dummy variable (and thus does not include interaction terms). We observe only small changes to the coefficient estimates on the other regressors and thus conclude that the results observed for specification (5) are not sensitive to the way the percentage of English learners is measured.</p>
<p>We continue by reproducing Figure 8.10 of the book for interpretation of the nonlinear specifications (2), (5) and (7).</p>
<div class="unfolded">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># scatterplot</span>
<span class="kw">plot</span>(CASchools<span class="op">$</span>size, 
     CASchools<span class="op">$</span>score, 
     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">28</span>),
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">600</span>, <span class="dv">740</span>),
     <span class="dt">pch =</span> <span class="dv">20</span>, 
     <span class="dt">col =</span> <span class="st">&quot;gray&quot;</span>, 
     <span class="dt">xlab =</span> <span class="st">&quot;Student-Teacher Ratio&quot;</span>, 
     <span class="dt">ylab =</span> <span class="st">&quot;Test Score&quot;</span>)

<span class="co"># add a legend</span>
<span class="kw">legend</span>(<span class="st">&quot;top&quot;</span>, 
       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Linear Regression (2)&quot;</span>, 
                  <span class="st">&quot;Cubic Regression (5)&quot;</span>, 
                  <span class="st">&quot;Cubic Regression (7)&quot;</span>),
       <span class="dt">cex =</span> <span class="fl">0.8</span>,
       <span class="dt">ncol =</span> <span class="dv">3</span>,
       <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),
       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>))

<span class="co"># data for use with predict()</span>
new_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;size&quot;</span> =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">16</span>, <span class="dv">24</span>, <span class="fl">0.05</span>), 
                       <span class="st">&quot;english&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>english),
                       <span class="st">&quot;lunch&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>lunch),
                       <span class="st">&quot;income&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>income),
                       <span class="st">&quot;HiEL&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>HiEL))

<span class="co"># add estimated regression function for model (2)</span>
fitted &lt;-<span class="st"> </span><span class="kw">predict</span>(TestScore_mod2, <span class="dt">newdata =</span> new_data)

<span class="kw">lines</span>(new_data<span class="op">$</span>size, 
      fitted,
      <span class="dt">lwd =</span> <span class="fl">1.5</span>,
      <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)

<span class="co"># add estimated regression function for model (5)</span>
fitted &lt;-<span class="st"> </span><span class="kw">predict</span>(TestScore_mod5, <span class="dt">newdata =</span> new_data)

<span class="kw">lines</span>(new_data<span class="op">$</span>size, 
      fitted, 
      <span class="dt">lwd =</span> <span class="fl">1.5</span>,
      <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)

<span class="co"># add estimated regression function for model (7)</span>
fitted &lt;-<span class="st"> </span><span class="kw">predict</span>(TestScore_mod7, <span class="dt">newdata =</span> new_data)

<span class="kw">lines</span>(new_data<span class="op">$</span>size, 
      fitted, 
      <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,
      <span class="dt">lwd =</span> <span class="fl">1.5</span>,
      <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="URFITE_files/figure-html/unnamed-chunk-61-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<p>For the above figure all regressors except <span class="math inline">\(size\)</span> are set to their sample averages. We see that the cubic regressions (5) and (7) are almost identical. They indicate that the relation between test scores and the student-teacher ratio only has a small amount of nonlinearity since they do not deviate much from the regression function of (2).</p>
<p>The next code chunk reproduces Figure 8.11 of the book. We use <tt>plot()</tt> and <tt>points()</tt> to color observations depending on <span class="math inline">\(HiEL\)</span>. Again, the regression lines are drawn based on predictions using average sample averages of all regressors except for <span class="math inline">\(size\)</span>.</p>
<div class="unfolded">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># draw scatterplot</span>

<span class="co"># observations with HiEL = 0</span>
<span class="kw">plot</span>(CASchools<span class="op">$</span>size[CASchools<span class="op">$</span>HiEL <span class="op">==</span><span class="st"> </span><span class="dv">0</span>], 
     CASchools<span class="op">$</span>score[CASchools<span class="op">$</span>HiEL <span class="op">==</span><span class="st"> </span><span class="dv">0</span>], 
     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">28</span>),
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">600</span>, <span class="dv">730</span>),
     <span class="dt">pch =</span> <span class="dv">20</span>, 
     <span class="dt">col =</span> <span class="st">&quot;gray&quot;</span>, 
     <span class="dt">xlab =</span> <span class="st">&quot;Student-Teacher Ratio&quot;</span>, 
     <span class="dt">ylab =</span> <span class="st">&quot;Test Score&quot;</span>)

<span class="co"># observations with HiEL = 1</span>
<span class="kw">points</span>(CASchools<span class="op">$</span>size[CASchools<span class="op">$</span>HiEL <span class="op">==</span><span class="st"> </span><span class="dv">1</span>], 
       CASchools<span class="op">$</span>score[CASchools<span class="op">$</span>HiEL <span class="op">==</span><span class="st"> </span><span class="dv">1</span>],
       <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>,
       <span class="dt">pch =</span> <span class="dv">20</span>)

<span class="co"># add a legend</span>
<span class="kw">legend</span>(<span class="st">&quot;top&quot;</span>, 
       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Regression (6) with HiEL=0&quot;</span>, <span class="st">&quot;Regression (6) with HiEL=1&quot;</span>),
       <span class="dt">cex =</span> <span class="fl">0.7</span>,
       <span class="dt">ncol =</span> <span class="dv">2</span>,
       <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),
       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))

<span class="co"># data for use with &#39;predict()&#39;</span>
new_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;size&quot;</span> =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">12</span>, <span class="dv">28</span>, <span class="fl">0.05</span>), 
                       <span class="st">&quot;english&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>english),
                       <span class="st">&quot;lunch&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>lunch),
                       <span class="st">&quot;income&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>income),
                       <span class="st">&quot;HiEL&quot;</span> =<span class="st"> </span><span class="dv">0</span>)

<span class="co"># add estimated regression function for model (6) with HiEL=0</span>
fitted &lt;-<span class="st"> </span><span class="kw">predict</span>(TestScore_mod6, <span class="dt">newdata =</span> new_data)

<span class="kw">lines</span>(new_data<span class="op">$</span>size, 
      fitted, 
      <span class="dt">lwd =</span> <span class="fl">1.5</span>,
      <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>)

<span class="co"># add estimated regression function for model (6) with HiEL=1</span>
new_data<span class="op">$</span>HiEL &lt;-<span class="st"> </span><span class="dv">1</span>

fitted &lt;-<span class="st"> </span><span class="kw">predict</span>(TestScore_mod6, <span class="dt">newdata =</span> new_data)

<span class="kw">lines</span>(new_data<span class="op">$</span>size, 
      fitted, 
      <span class="dt">lwd =</span> <span class="fl">1.5</span>,
      <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="URFITE_files/figure-html/unnamed-chunk-62-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<p>The regression output shows that model (6) finds statistically significant coefficients on the interaction terms <span class="math inline">\(HiEL:size\)</span>, <span class="math inline">\(HiEL:size^2\)</span> and <span class="math inline">\(HiEL:size^3\)</span>, i.e., there is evidence that the nonlinear relationship connecting test scores and student-teacher ratio depends on the fraction of English learning students in the district. However, the above figure shows that this difference is not of practical importance and is a good example for why one should be careful when interpreting nonlinear models: although the two regression functions look different, we see that the slope of both functions is almost identical for student-teacher ratios between <span class="math inline">\(17\)</span> and <span class="math inline">\(23\)</span>. Since this range includes almost <span class="math inline">\(90\%\)</span> of all observations, we can be confident that nonlinear interactions between the fraction of English learners and the student-teacher ratio can be neglected.</p>
<p>One might be tempted to object since both functions show opposing slopes for student-teacher ratios below <span class="math inline">\(15\)</span> and beyond <span class="math inline">\(24\)</span>. There are at least to possible objections:</p>
<ol style="list-style-type: decimal">
<li><p>There are only few observations with low and high values of the student-teacher ratio, so there is only little information to be exploited when estimating the model. This means the estimated function is less precise in the tails of the data set.</p></li>
<li><p>The above described behavior of the regression function, is a typical caveat when using cubic functions since they generally show extreme behavior for extreme regressor values. Think of the graph of <span class="math inline">\(f(x) = x^3\)</span>.</p></li>
</ol>
<p>We thus find no clear evidence for a relation between class size and test scores on the percentage of English learners in the district.</p>
</div>
<div id="summary" class="section level4 unnumbered">
<h4>Summary</h4>
<p>We are now able to answer the three question posed at the beginning of this section.</p>
<ol style="list-style-type: decimal">
<li><p>In the linear models, the percentage of English learners has only little influence on the effect on test scores from changing the student-teacher ratio. This result stays valid if we control for economic background of the students. While the cubic specification (6) provides evidence that the effect the student-teacher ratio on test score depends on the share of English learners, the strength of this effect is negligible.</p></li>
<li><p>When controlling for the studentsâ€™ economic background we find evidence of nonlinearities in the relationship between student-teacher ratio and test scores.</p></li>
<li><p>The linear specification (2) predicts that a reduction of the student-teacher ratio by two students per teacher leads to an improvement in test scores of about <span class="math inline">\(-0.73 \times (-2) = 1.46\)</span> points. Since the model is linear, this effect is independent of the class size. Assume that the student-teacher ratio is <span class="math inline">\(20\)</span>. For example, the nonlinear model (5) predicts that the reduction increases test scores by <span class="math display">\[64.33\cdot18+18^2\cdot(-3.42)+18^3\cdot(0.059) - (64.33\cdot20+20^2\cdot(-3.42)+20^3\cdot(0.059)) \approx 3.3\]</span> points. If the ratio is <span class="math inline">\(22\)</span>, a reduction to <span class="math inline">\(20\)</span> leads to a predicted improvement in test scores of <span class="math display">\[64.33\cdot20+20^2\cdot(-3.42)+20^3\cdot(0.059) - (64.33\cdot22+22^2\cdot(-3.42)+22^3\cdot(0.059)) \approx 2.4\]</span> points. This suggests that the effect is stronger in smaller classes.</p></li>
</ol>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="interactions-between-independent-variables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercises.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 1
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
