<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Econometrics with R</title>
  <meta name="description" content="‘Introduction to Econometrics with R’ is an interactive companion to the well-received textbook ‘Introduction to Econometrics’ by James H. Stock and Mark W. Watson (2015). It guides students in implementing the empirical applications presented throughout the book using the statistical software package R.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Econometrics with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="‘Introduction to Econometrics with R’ is an interactive companion to the well-received textbook ‘Introduction to Econometrics’ by James H. Stock and Mark W. Watson (2015). It guides students in implementing the empirical applications presented throughout the book using the statistical software package R." />
  <meta name="github-repo" content="Emwikts1970/URFITE-Bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Econometrics with R" />
  
  <meta name="twitter:description" content="‘Introduction to Econometrics with R’ is an interactive companion to the well-received textbook ‘Introduction to Econometrics’ by James H. Stock and Mark W. Watson (2015). It guides students in implementing the empirical applications presented throughout the book using the statistical software package R." />
  <meta name="twitter:image" content="images/cover.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="3-ivr.html">
<link rel="next" href="3-2-TGIVRM.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- font families -->

<link href="https://fonts.googleapis.com/css?family=PT+Sans|Pacifico|Source+Sans+Pro" rel="stylesheet">

<!-- function to adjust height of iframes automatically depending on content loaded -->

<script>
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  }
</script>

<script src="js/hideOutput.js"></script>
<script type="text/javascript" src="MathJax-2.7.2/MathJax.js?config=default"></script>

 <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js", "TeX/AMSmath.js"],
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
        jax: ["input/TeX","output/CommonHTML"]
      });
      MathJax.Hub.processSectionDelay = 0;
  </script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110299877-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110299877-1');
</script>

<!-- open review block -->

<script async defer src="https://hypothes.is/embed.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://www.oek.wiwi.uni-due.de/en/">Chair of Econometrics @ Uni-DUE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="1-introduction.html"><a href="1-introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-a-very-short-introduction-to-r-and-rstudio.html"><a href="1-1-a-very-short-introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>1.1</b> A Very Short Introduction to <tt>R</tt> and <em>RStudio</em></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-nrf.html"><a href="2-nrf.html"><i class="fa fa-check"></i><b>2</b> Nonlinear Regression Functions</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-a-general-strategy-for-modelling-nonlinear-regression-functions.html"><a href="2-1-a-general-strategy-for-modelling-nonlinear-regression-functions.html"><i class="fa fa-check"></i><b>2.1</b> A General Strategy for Modelling Nonlinear Regression Functions</a></li>
<li class="chapter" data-level="2.2" data-path="2-2-nfoasiv.html"><a href="2-2-nfoasiv.html"><i class="fa fa-check"></i><b>2.2</b> Nonlinear Functions of a Single Independent Variable</a><ul>
<li class="chapter" data-level="" data-path="2-2-nfoasiv.html"><a href="2-2-nfoasiv.html#polynomials"><i class="fa fa-check"></i>Polynomials</a></li>
<li class="chapter" data-level="" data-path="2-2-nfoasiv.html"><a href="2-2-nfoasiv.html#logarithms"><i class="fa fa-check"></i>Logarithms</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-3-interactions-between-independent-variables.html"><a href="2-3-interactions-between-independent-variables.html"><i class="fa fa-check"></i><b>2.3</b> Interactions Between Independent Variables</a></li>
<li class="chapter" data-level="2.4" data-path="2-4-nonlinear-effects-on-test-scores-of-the-student-teacher-ratio.html"><a href="2-4-nonlinear-effects-on-test-scores-of-the-student-teacher-ratio.html"><i class="fa fa-check"></i><b>2.4</b> Nonlinear Effects on Test Scores of the Student-Teacher Ratio</a></li>
<li class="chapter" data-level="2.5" data-path="2-5-exercises.html"><a href="2-5-exercises.html"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-ivr.html"><a href="3-ivr.html"><i class="fa fa-check"></i><b>3</b> Instrumental Variables Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="3-1-TIVEWASRAASI.html"><a href="3-1-TIVEWASRAASI.html"><i class="fa fa-check"></i><b>3.1</b> The IV Estimator with a Single Regressor and a Single Instrument</a></li>
<li class="chapter" data-level="3.2" data-path="3-2-TGIVRM.html"><a href="3-2-TGIVRM.html"><i class="fa fa-check"></i><b>3.2</b> The General IV Regression Model</a></li>
<li class="chapter" data-level="3.3" data-path="3-3-civ.html"><a href="3-3-civ.html"><i class="fa fa-check"></i><b>3.3</b> Checking Instrument Validity</a></li>
<li class="chapter" data-level="3.4" data-path="3-4-attdfc.html"><a href="3-4-attdfc.html"><i class="fa fa-check"></i><b>3.4</b> Application to the Demand for Cigarettes</a></li>
<li class="chapter" data-level="3.5" data-path="3-5-where-do-valid-instruments-come-from.html"><a href="3-5-where-do-valid-instruments-come-from.html"><i class="fa fa-check"></i><b>3.5</b> Where Do Valid Instruments Come From?</a></li>
<li class="chapter" data-level="3.6" data-path="3-6-exercises-1.html"><a href="3-6-exercises-1.html"><i class="fa fa-check"></i><b>3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Introduction to Econometrics with R</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div class = rmdreview>
This book is in <b>Open Review</b>. We want your feedback to make the book better for you and other students. You may annotate some text by <span style="background-color: #3297FD; color: white">selecting it with the cursor</span> and then click the <i class="h-icon-annotate"></i> on the pop-up menu. You can also see the annotations of others: click the <i class="h-icon-chevron-left"></i> in the upper right hand corner of the page <i class="fa fa-arrow-circle-right  fa-rotate-315" aria-hidden="true"></i>
</div>
<div id="TIVEWASRAASI" class="section level2">
<h2><span class="header-section-number">3.1</span> The IV Estimator with a Single Regressor and a Single Instrument</h2>
<p>Consider the simple regression model</p>
<span class="math display" id="eq:srm12">\[\begin{align}
  Y_i = \beta_0 + \beta_1 X_i + u_i \ \ , \ \ i=1,\dots,n  \tag{3.1}
\end{align}\]</span>
<p>where the error term <span class="math inline">\(u_i\)</span> is correlated with the regressor <span class="math inline">\(X_i\)</span> (<span class="math inline">\(X\)</span> is <em>endogenous</em>) such that OLS is inconsistent for the true <span class="math inline">\(\beta_1\)</span>. In the most simple case, IV regression uses a single instrumental variable <span class="math inline">\(Z\)</span> to obtain a consistent estimator for <span class="math inline">\(\beta_1\)</span>.</p>
<p><span class="math inline">\(Z\)</span> must satisfy two conditions to be a valid instrument:</p>
<p><strong>1. Instrument relevance condition</strong>:</p>
<center>
<span class="math inline">\(X\)</span> and its instrument <span class="math inline">\(Z\)</span> <em>must be</em> correlated: <span class="math inline">\(\rho_{Z_i,X_i} \neq 0\)</span>.
</center>
<p><strong>2. Instrument exogeneity condition</strong>:</p>
<center>
The instrument <span class="math inline">\(Z\)</span> <em>must not be</em> correlated with the error term <span class="math inline">\(u\)</span>: <span class="math inline">\(\rho_{Z_i,u_i} = 0\)</span>.
</center>
<div id="the-two-stage-least-squares-estimator" class="section level4 unnumbered">
<h4>The Two-Stage Least Squares Estimator</h4>
<p>As can be guessed from its name, TSLS proceeds in two stages. In the first stage, the variation in the endogenous regressor <span class="math inline">\(X\)</span> is decomposed into a problem-free component that is explained by the instrument <span class="math inline">\(Z\)</span> and a problematic component that is correlated with the error <span class="math inline">\(u_i\)</span>. The second stage uses the problem-free component of the variation in <span class="math inline">\(X\)</span> to estimate <span class="math inline">\(\beta_1\)</span>.</p>
<p>The first stage regression model is <span class="math display">\[X_i = \pi_0 + \pi_1 Z_i + \nu_i,\]</span> where <span class="math inline">\(\pi_0 + \pi_1 Z_i\)</span> is the component of <span class="math inline">\(X_i\)</span> that is explained by <span class="math inline">\(Z_i\)</span> while <span class="math inline">\(\nu_i\)</span> is the component that cannot be explained by <span class="math inline">\(Z_i\)</span> and exhibits correlation with <span class="math inline">\(u_i\)</span>.</p>
<p>Using the OLS estimates <span class="math inline">\(\widehat{\pi}_0\)</span> and <span class="math inline">\(\widehat{\pi}_1\)</span> we obtain predicted values <span class="math inline">\(\widehat{X}_i, \ \ i=1,\dots,n\)</span>. If <span class="math inline">\(Z\)</span> is a valid instrument, the <span class="math inline">\(\widehat{X}_i\)</span> are problem-free in the sense that <span class="math inline">\(\widehat{X}\)</span> is exogenous in a regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(\widehat{X}\)</span> which is done in the second stage regression. The second stage produces <span class="math inline">\(\widehat{\beta}_0^{TSLS}\)</span> and <span class="math inline">\(\widehat{\beta}_1^{TSLS}\)</span>, the TSLS estimates of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>.</p>
<p>For the case of a single instrument one can show that the TSLS estimator of <span class="math inline">\(\beta_1\)</span> is</p>
<span class="math display" id="eq:simpletsls">\[\begin{align}
\widehat{\beta}_1^{TSLS} = \frac{s_{ZY}}{s_{ZX}} = \frac{\frac{1}{n-1}\sum_{i=1}^n(Y_i - \overline{Y})(Z_i - \overline{Z})}{\frac{1}{n-1}\sum_{i=1}^n(X_i - \overline{X})(Z_i - \overline{Z})}, \tag{3.2}
\end{align}\]</span>
<p>which is nothing but the ratio of the sample covariance between <span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span> to the sample covariance between <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span>.</p>
<p>As shown in Appendix 12.3 of the book, <a href="3-1-TIVEWASRAASI.html#eq:simpletsls">(3.2)</a> is a consistent estimator for <span class="math inline">\(\beta_1\)</span> in <a href="3-1-TIVEWASRAASI.html#eq:srm12">(3.1)</a> under the assumption that <span class="math inline">\(Z\)</span> is a valid instrument. Just as for every other OLS estimator we have considered so far, the CLT implies that the distribution of <span class="math inline">\(\widehat{\beta}_1^{TSLS}\)</span> can be approximated by a normal distribution if the sample size is large. This allows us to use <span class="math inline">\(t\)</span>-statistics and confidence intervals which are also computed by certain <tt>R</tt> functions. A more detailed argument on the large-sample distribution of the TSLS estimator is sketched in Appendix 12.3 of the book.</p>
</div>
<div id="application-to-the-demand-for-cigarettes" class="section level4 unnumbered">
<h4>Application to the Demand For Cigarettes</h4>
<p>The relation between the demand for and the price of commodities is a simple yet widespread problem in economics. Health economics is concerned with the study of how health-affecting behavior of individuals is influenced by the health-care system and regulation policy. Probably the most prominent example in public policy debates is smoking as it is related to many illnesses and negative externalities.</p>
<p>It is plausible that cigarette consumption can be reduced by taxing cigarettes more heavily. The question is by <em>how much</em> taxes must be increased to reach a certain reduction in cigarette consumption. Economists use elasticities to answer this kind of question. Since the price elasticity for the demand of cigarettes is unknown, it must be estimated. As discussed in the box <em>Who Invented Instrumental Variables Regression</em> presented in Chapter 12.1 of the book, an OLS regression of log quantity on log price cannot be used to estimate the effect of interest since there is simultaneous causality between demand and supply. Instead, IV regression can be used.</p>
<p>We use the data set <tt>CigarettesSW</tt> which comes with the package <tt>AER</tt>. It is a panel data set that contains observations on cigarette consumption and several economic indicators for all 48 continental federal states of the U.S. from 1985 to 1995. Following the book we consider data for the cross section of states in 1995 only.</p>
<p>We start by loading the package, attaching the data set and getting an overview.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load the data set and get an overview</span>
<span class="kw">library</span>(AER)
<span class="kw">data</span>(<span class="st">&quot;CigarettesSW&quot;</span>)
<span class="kw">summary</span>(CigarettesSW)</code></pre></div>
<pre><code>##      state      year         cpi          population      
##  AL     : 2   1985:48   Min.   :1.076   Min.   :  478447  
##  AR     : 2   1995:48   1st Qu.:1.076   1st Qu.: 1622606  
##  AZ     : 2             Median :1.300   Median : 3697472  
##  CA     : 2             Mean   :1.300   Mean   : 5168866  
##  CO     : 2             3rd Qu.:1.524   3rd Qu.: 5901500  
##  CT     : 2             Max.   :1.524   Max.   :31493524  
##  (Other):84                                               
##      packs            income               tax            price       
##  Min.   : 49.27   Min.   :  6887097   Min.   :18.00   Min.   : 84.97  
##  1st Qu.: 92.45   1st Qu.: 25520384   1st Qu.:31.00   1st Qu.:102.71  
##  Median :110.16   Median : 61661644   Median :37.00   Median :137.72  
##  Mean   :109.18   Mean   : 99878736   Mean   :42.68   Mean   :143.45  
##  3rd Qu.:123.52   3rd Qu.:127313964   3rd Qu.:50.88   3rd Qu.:176.15  
##  Max.   :197.99   Max.   :771470144   Max.   :99.00   Max.   :240.85  
##                                                                       
##       taxs       
##  Min.   : 21.27  
##  1st Qu.: 34.77  
##  Median : 41.05  
##  Mean   : 48.33  
##  3rd Qu.: 59.48  
##  Max.   :112.63  
## </code></pre>
<p>Use <code>?CigarettesSW</code> for a detailed description of the variables.</p>
<p>We are interested in estimating <span class="math inline">\(\beta_1\)</span> in</p>
<span class="math display" id="eq:cigstsls">\[\begin{align}
  \log(Q_i^{cigarettes}) = \beta_0 + \beta_1 \log(P_i^{cigarettes}) + u_i, \tag{3.3}
\end{align}\]</span>
<p>where <span class="math inline">\(Q_i^{cigarettes}\)</span> is the number of cigarette packs per capita sold and <span class="math inline">\(P_i^{cigarettes}\)</span> is the after-tax average real price per pack of cigarettes in state <span class="math inline">\(i\)</span>.</p>
<p>The instrumental variable we are going to use for instrumenting the endogenous regressor <span class="math inline">\(\log(P_i^{cigarettes})\)</span> is <span class="math inline">\(SalesTax\)</span>, the portion of taxes on cigarettes arising from the general sales tax. <span class="math inline">\(SalesTax\)</span> is measured in dollars per pack. The idea is that <span class="math inline">\(SalesTax\)</span> is a relevant instrument as it is included in the after-tax average price per pack. Also, it is plausible that <span class="math inline">\(SalesTax\)</span> is exogenous since the sales tax does not influence quantity sold directly but indirectly through the price.</p>
<p>We perform some transformations in order to obtain deflated cross section data for the year 1995.</p>
<p>We also compute the sample correlation between the sales tax and price per pack. The sample correlation is a consistent estimator of the population correlation. The estimate of approximately <span class="math inline">\(0.614\)</span> indicates that <span class="math inline">\(SalesTax\)</span> and <span class="math inline">\(P_i^{cigarettes}\)</span> exhibit positive correlation which meets our expectations: higher sales taxes lead to higher prices. However, a correlation analysis like this is not sufficient for checking whether the instrument is relevant. We will later come back to the issue of checking whether an instrument is relevant and exogenous.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute real per capita prices</span>
CigarettesSW<span class="op">$</span>rprice &lt;-<span class="st"> </span><span class="kw">with</span>(CigarettesSW, price <span class="op">/</span><span class="st"> </span>cpi)

<span class="co">#  compute the sales tax</span>
CigarettesSW<span class="op">$</span>salestax &lt;-<span class="st"> </span><span class="kw">with</span>(CigarettesSW, (taxs <span class="op">-</span><span class="st"> </span>tax) <span class="op">/</span><span class="st"> </span>cpi)

<span class="co"># check the correlation between sales tax and price</span>
<span class="kw">cor</span>(CigarettesSW<span class="op">$</span>salestax, CigarettesSW<span class="op">$</span>price)</code></pre></div>
<pre><code>## [1] 0.6141228</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate a subset for the year 1995</span>
c1995 &lt;-<span class="st"> </span><span class="kw">subset</span>(CigarettesSW, year <span class="op">==</span><span class="st"> &quot;1995&quot;</span>)</code></pre></div>
<p>The first stage regression is <span class="math display">\[\log(P_i^{cigarettes}) = \pi_0 + \pi_1 SalesTax_i + \nu_i.\]</span> We estimate this model in <tt>R</tt> using <tt>lm()</tt>. In the second stage we run a regression of <span class="math inline">\(\log(Q_i^{cigarettes})\)</span> on <span class="math inline">\(\widehat{\log(P_i^{cigarettes})}\)</span> to obtain <span class="math inline">\(\widehat{\beta}_0^{TSLS}\)</span> and <span class="math inline">\(\widehat{\beta}_1^{TSLS}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># perform the first stage regression</span>
cig_s1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(rprice) <span class="op">~</span><span class="st"> </span>salestax, <span class="dt">data =</span> c1995)

<span class="kw">coeftest</span>(cig_s1, <span class="dt">vcov =</span> vcovHC, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>)</code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##              Estimate Std. Error  t value  Pr(&gt;|t|)    
## (Intercept) 4.6165463  0.0289177 159.6444 &lt; 2.2e-16 ***
## salestax    0.0307289  0.0048354   6.3549 8.489e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The first stage regression is <span class="math display">\[\widehat{\log(P_i^{cigarettes})} = \underset{(0.03)}{4.62} + \underset{(0.005)}{0.031} SalesTax_i\]</span> which predicts the relation between sales tax price per cigarettes to be positive. How much of the observed variation in <span class="math inline">\(\log(P^{cigarettes})\)</span> is explained by the instrument <span class="math inline">\(SalesTax\)</span>? This can be answered by looking at the regression’s <span class="math inline">\(R^2\)</span> which states that about <span class="math inline">\(47\%\)</span> of the variation in after tax prices is explained by the variation of the sales tax across states.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># inspect the R^2 of the first stage regression</span>
<span class="kw">summary</span>(cig_s1)<span class="op">$</span>r.squared</code></pre></div>
<pre><code>## [1] 0.4709961</code></pre>
<p>We next store <span class="math inline">\(\widehat{\log(P_i^{cigarettes})}\)</span>, the fitted values obtained by the first stage regression <tt>cig_s1</tt>, in the variable <tt>lcigp_pred</tt>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># store the predicted values</span>
lcigp_pred &lt;-<span class="st"> </span>cig_s1<span class="op">$</span>fitted.values</code></pre></div>
<p>Next, we run the second stage regression which gives us the TSLS estimates we seek.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># run the stage 2 regression</span>
cig_s2 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(c1995<span class="op">$</span>packs) <span class="op">~</span><span class="st"> </span>lcigp_pred)
<span class="kw">coeftest</span>(cig_s2, <span class="dt">vcov =</span> vcovHC)</code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##             Estimate Std. Error t value  Pr(&gt;|t|)    
## (Intercept)  9.71988    1.70304  5.7074 7.932e-07 ***
## lcigp_pred  -1.08359    0.35563 -3.0469  0.003822 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Thus estimating the model <a href="3-1-TIVEWASRAASI.html#eq:cigstsls">(3.3)</a> using TSLS yields</p>
<span class="math display" id="eq:ecigstsls">\[\begin{align}
  \widehat{\log(Q_i^{cigarettes})} = \underset{(1.70)}{9.72} + \underset{(0.36)}{1.08} \log(P_i^{cigarettes}), \tag{3.4}
\end{align}\]</span>
<p>where we write <span class="math inline">\(\log(P_i^{cigarettes})\)</span> instead of <span class="math inline">\(\widehat{\log(P_i^{cigarettes})}\)</span> for consistency with the book.</p>
<p>The function <tt>ivreg()</tt> from the package <tt>AER</tt> carries out TSLS procedure automatically. It is used similarly as <tt>lm()</tt>. Instruments can be added to the usual specification of the regression formula using a vertical bar separating the model equation from the instruments. Thus, for the regression at hand the correct formula is <tt>log(packs) ~ log(rprice) | salestax</tt>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># perform TSLS using &#39;ivreg()&#39;</span>
cig_ivreg &lt;-<span class="st"> </span><span class="kw">ivreg</span>(<span class="kw">log</span>(packs) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(rprice) <span class="op">|</span><span class="st"> </span>salestax, <span class="dt">data =</span> c1995)

<span class="kw">coeftest</span>(cig_ivreg, <span class="dt">vcov =</span> vcovHC, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>)</code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##             Estimate Std. Error t value  Pr(&gt;|t|)    
## (Intercept)  9.71988    1.52832  6.3598 8.346e-08 ***
## log(rprice) -1.08359    0.31892 -3.3977  0.001411 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We find that the coefficient estimates coincide for both approaches.</p>
<p><strong>Two Notes on the Computation of TSLS Standard Errors</strong></p>
<ol style="list-style-type: decimal">
<li><p>We have demonstrated that running the individual regressions for each stage of TSLS using <tt>lm()</tt> leads to the same coefficient estimates as when using <tt>ivreg()</tt>. However, the standard errors reported for the second-stage regression, e.g., by <tt>coeftest()</tt> or <tt>summary()</tt>, are <em>invalid</em>: neither adjusts for using predictions from the first-stage regression as regressors in the second-stage regression. Fortunately, <tt>ivreg()</tt> performs the necessary adjustment automatically. This is another advantage over manual step-by-step estimation which we have done above for demonstrating the mechanics of the procedure.</p></li>
<li><p>Just like in multiple regression it is important to compute heteroskedasticity-robust standard errors as we have done above using <tt>vcovHC()</tt>.</p></li>
</ol>
<p>The TSLS estimate for <span class="math inline">\(\beta_1\)</span> in <a href="3-1-TIVEWASRAASI.html#eq:ecigstsls">(3.4)</a> suggests that an increase in cigarette prices by one percent reduces cigarette consumption by roughly <span class="math inline">\(1.08\)</span> percentage points, which is fairly elastic. However, we should keep in mind that this estimate might not be trustworthy even though we used IV estimation: there still might be a bias due to omitted variables. Thus a multiple IV regression approach is needed.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="3-ivr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="3-2-TGIVRM.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": true,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 1
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
