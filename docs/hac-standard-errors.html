<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Using R for Introduction to Econometrics</title>
  <meta name="description" content="Using <tt>R</tt> for Introduction to Econometrics">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Using R for Introduction to Econometrics" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="Emwikts1970/URFITE-Bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Using R for Introduction to Econometrics" />
  
  
  

<meta name="author" content="Christoph Hanck, Martin Arnold, Alexander Gerber and Martin Schmelzer">


<meta name="date" content="2018-08-02">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="dynamic-multipliers-and-cumulative-dynamic-multipliers.html">
<link rel="next" href="estimation-of-dynamic-causal-effects-with-strictly-exogeneous-regressors.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="js/hideOutput.js"></script>
<script type="text/javascript" src="MathJax-2.7.2/MathJax.js?config=default"></script>

 <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js", "TeX/AMSmath.js"],
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
        jax: ["input/TeX","output/CommonHTML"]
      });
      MathJax.Hub.processSectionDelay = 0;
  </script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110299877-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110299877-1');
</script>

<!-- open review block -->

<script async defer src="https://hypothes.is/embed.js"></script>

<!-- datacamp-light-latest -->

<script src="https://cdn.datacamp.com/datacamp-light-latest.min.js"></script>


<!-- <script src="js/d3.v3.min.js"></script>
<script src="js/leastsquares.js"></script>
<script src="js/d3functions.js"></script>
<script src="d3.slider.js"></script>
<script src="slrm.js"></script> -->


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">URFITE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="a-very-short-introduction-to-r-and-rstudio.html"><a href="a-very-short-introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>1.1</b> A Very Short Introduction to <tt>R</tt> and <em>RStudio</em></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="eodce.html"><a href="eodce.html"><i class="fa fa-check"></i><b>2</b> Estimation of Dynamic Causal Effects</a><ul>
<li class="chapter" data-level="2.1" data-path="the-orange-juice-data.html"><a href="the-orange-juice-data.html"><i class="fa fa-check"></i><b>2.1</b> The Orange Juice Data</a></li>
<li class="chapter" data-level="2.2" data-path="dynamic-causal-effects.html"><a href="dynamic-causal-effects.html"><i class="fa fa-check"></i><b>2.2</b> Dynamic Causal Effects</a></li>
<li class="chapter" data-level="2.3" data-path="dynamic-multipliers-and-cumulative-dynamic-multipliers.html"><a href="dynamic-multipliers-and-cumulative-dynamic-multipliers.html"><i class="fa fa-check"></i><b>2.3</b> Dynamic Multipliers and Cumulative Dynamic Multipliers</a></li>
<li class="chapter" data-level="2.4" data-path="hac-standard-errors.html"><a href="hac-standard-errors.html"><i class="fa fa-check"></i><b>2.4</b> HAC Standard Errors</a></li>
<li class="chapter" data-level="2.5" data-path="estimation-of-dynamic-causal-effects-with-strictly-exogeneous-regressors.html"><a href="estimation-of-dynamic-causal-effects-with-strictly-exogeneous-regressors.html"><i class="fa fa-check"></i><b>2.5</b> Estimation of Dynamic Causal Effects with Strictly Exogeneous Regressors</a></li>
<li class="chapter" data-level="2.6" data-path="orange-juice-prices-and-cold-weather.html"><a href="orange-juice-prices-and-cold-weather.html"><i class="fa fa-check"></i><b>2.6</b> Orange Juice Prices and Cold Weather</a></li>
<li class="chapter" data-level="2.7" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using <tt>R</tt> for Introduction to Econometrics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div class = rmdreview>
This book is in <b>Open Review</b>. We want your feedback to make the book better for you and other students. You may annotate some text by <span style="background-color: #3297FD; color: white">selecting it with the cursor</span> and then click the <i class="h-icon-annotate"></i> on the pop-up menu. You can also see the annotations of others: click the <i class="h-icon-chevron-left"></i> in the upper right hand corner of the page <i class="fa fa-arrow-circle-right  fa-rotate-315" aria-hidden="true"></i>
</div>
<div id="hac-standard-errors" class="section level2">
<h2><span class="header-section-number">2.4</span> HAC Standard Errors</h2>
<p>The error term <span class="math inline">\(u_t\)</span> in the distributed lag model <a href="dynamic-causal-effects.html#eq:dlm">(2.2)</a> may be serially correlated due to serially correlated determinants of <span class="math inline">\(Y_t\)</span> that are not included as regressors. When these factors are not correlated with the regressors included in the model, serially correlated errors do not violate the assumption of exogeneity such that the OLS estimator remains unbiased and consistent.</p>
<p>However, autocorrelated standard errors render the usual homoskedasticity-only <em>and</em> heteroskedasticity-robust standard errors invalid and may cause misleading inference. HAC errors are a remedy.</p>
<div class="keyconcept">
<h3 class="right">
Key Concept 15.2
</h3>
<h3 class="left">
HAC Standard errors
</h3>
<p>
<p><strong>Problem</strong>:</p>
<p>If the error term <span class="math inline">\(u_t\)</span> in the distributed lag model <a href="dynamic-causal-effects.html#eq:dlm">(2.2)</a> is serially correlated, statistical inference that rests on usual (heteroskedasticity-robust) standard errors can be strongly misleading.</p>
<p><strong>Solution</strong>:</p>
<p>Heteroskedasticity- and autocorrelation-consistent (HAC) estimators of the variance-covariance matrix circumvent this issue. There are <tt>R</tt> functions like <tt>vcovHAC()</tt> from the package <tt>sandwich</tt> which are convenient for computation of such estimators.</p>
The package <tt>sandwich</tt> also contains the function <tt>NeweyWest()</tt>, an implementation of the HAC variance-covariance estimator proposed by <span class="citation">Newey &amp; West (<a href="#ref-newey1987">1987</a>)</span>.
</p>
</div>
Consider the distributed lag regression model with no lags and a single regressor <span class="math inline">\(X_t\)</span>
<span class="math display">\[\begin{align*}
  Y_t = \beta_0 + \beta_1 X_t + u_t.
\end{align*}\]</span>
with autocorrelated errors. A brief derivation of
<span class="math display" id="eq:nwhac">\[\begin{align}
  \overset{\sim}{\sigma}^2_{\widehat{\beta}_1} = \widehat{\sigma}^2_{\widehat{\beta}_1} \widehat{f}_t \tag{2.4}
\end{align}\]</span>
the so-called <em>Newey-West variance estimator</em> for the variance of the OLS estimator of <span class="math inline">\(\beta_1\)</span> is presented in Chapter 15.4 of the book. <span class="math inline">\(\widehat{\sigma}^2_{\widehat{\beta}_1}\)</span> in <a href="hac-standard-errors.html#eq:nwhac">(2.4)</a> is the heteroskedasticity-robust variance estimate of <span class="math inline">\(\widehat{\beta}_1\)</span> and
<span class="math display" id="eq:nwhacf">\[\begin{align}
  \widehat{f}_t = 1 + 2 \sum_{j=1}^{m-1} \left(\frac{m-j}{m}\right) \overset{\sim}{\rho}_j \tag{2.5}
\end{align}\]</span>
<p>is a correction factor that adjusts for serially correlated errors and involves estimates of <span class="math inline">\(m-1\)</span> autocorrelation coefficients <span class="math inline">\(\overset{\sim}{\rho}_j\)</span>. As it turns out, using the sample autocorrelation as implemented in <code>acf()</code> to estimate the autocorrelation coefficients renders <a href="hac-standard-errors.html#eq:nwhac">(2.4)</a> inconsistent, see pp. 650-651 of the book for a detailed argument. Therefore, we use a somewhat different estimator. For a time series <span class="math inline">\(X\)</span> we have <span class="math display">\[ \ \overset{\sim}{\rho}_j = \frac{\sum_{t=j+1}^T \hat v_t \hat v_{t-j}}{\sum_{t=1}^T \hat v_t^2}, \ \text{with} \ \hat v= (X_t-\overline{X}) \hat u_t. \]</span> We implement this estimator in the function <tt>acf_c()</tt> below.</p>
<span class="math inline">\(m\)</span> in @ref{eq:nwhacf} is a truncation parameter to be chosen. A rule of thumb for choosing <span class="math inline">\(m\)</span> is
<span class="math display" id="eq:hactruncrot">\[\begin{align}
  m = \left \lceil{0.75 \cdot T^{1/3}}\right\rceil. \tag{2.6}
\end{align}\]</span>
<p>We simulate a time series that, as stated above, follows a distributed lag model with autocorrelated errors and then show how to compute the Newey-West HAC estimate of <span class="math inline">\(SE(\widehat{\beta}_1)\)</span> using <tt>R</tt>. This is done via two separate but, as we will see, identical approaches: at first we follow the derivation presented in the book step-by-step and compute the estimate “manually”. We then show that the result is exactly the estimate obtained when using the function <tt>NeweyWest()</tt>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># function that computes rho tilde</span>
acf_c &lt;-<span class="st"> </span><span class="cf">function</span>(x, j) {
  <span class="kw">return</span>(
    <span class="kw">t</span>(x[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>j)]) <span class="op">%*%</span><span class="st"> </span><span class="kw">na.omit</span>(<span class="kw">Lag</span>(x, j)) <span class="op">/</span><span class="st"> </span><span class="kw">t</span>(x) <span class="op">%*%</span><span class="st"> </span>x
  )
}

<span class="co"># simulate time series with serially correlated errors</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)

N &lt;-<span class="st"> </span><span class="dv">100</span>

eps &lt;-<span class="st"> </span><span class="kw">arima.sim</span>(<span class="dt">n =</span> N, <span class="dt">model =</span> <span class="kw">list</span>(<span class="dt">ma =</span> <span class="fl">0.5</span>))
X &lt;-<span class="st"> </span><span class="kw">runif</span>(N, <span class="dv">1</span>, <span class="dv">10</span>)
Y &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>eps

<span class="co"># compute OLS residuals</span>
res &lt;-<span class="st"> </span><span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span>X)<span class="op">$</span>res

<span class="co"># compute v</span>
v &lt;-<span class="st"> </span>(X <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(X)) <span class="op">*</span><span class="st"> </span>res

<span class="co"># compute robust estimate of beta_1 variance</span>
var_beta_hat &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>N <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(N<span class="op">-</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((X <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(X))<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>res<span class="op">^</span><span class="dv">2</span>) ) <span class="op">/</span><span class="st"> </span>
<span class="st">                        </span>(<span class="dv">1</span><span class="op">/</span>N <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((X <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(X))<span class="op">^</span><span class="dv">2</span>))<span class="op">^</span><span class="dv">2</span>

<span class="co"># rule of thumb truncation parameter</span>
m &lt;-<span class="st"> </span><span class="kw">floor</span>(<span class="fl">0.75</span> <span class="op">*</span><span class="st"> </span>N<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>))

<span class="co"># compute correction factor</span>
f_hat_T &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(
  (m <span class="op">-</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>(m<span class="op">-</span><span class="dv">1</span>))<span class="op">/</span>m <span class="op">*</span><span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>(m <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="cf">function</span>(i) <span class="kw">acf_c</span>(<span class="dt">x =</span> v, <span class="dt">j =</span> i))
  ) 

<span class="co"># compute Newey-West HAC estimate of the standard error </span>
<span class="kw">sqrt</span>(var_beta_hat <span class="op">*</span><span class="st"> </span>f_hat_T)</code></pre></div>
<pre><code>## [1] 0.04036208</code></pre>
<p>For the code to be reusable in other application, we use <tt>sapply()</tt> to estimate the <span class="math inline">\(m-1\)</span> autocorrelations <span class="math inline">\(\overset{\sim}{\rho}_j\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using NeweyWest():</span>
NW_VCOV &lt;-<span class="st"> </span><span class="kw">NeweyWest</span>(<span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span>X), 
              <span class="dt">lag =</span> m <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">prewhite =</span> F, 
              <span class="dt">adjust =</span> T
              )

<span class="co"># compute standard error</span>
<span class="kw">sqrt</span>(<span class="kw">diag</span>(NW_VCOV))[<span class="dv">2</span>]</code></pre></div>
<pre><code>##          X 
## 0.04036208</code></pre>
<p>By choosing <tt>lag = m-1</tt> we ensure that the maximum order of autocorrelations used is <span class="math inline">\(m-1\)</span> — just as in equation <a href="hac-standard-errors.html#eq:nwhacf">(2.5)</a>. Notice that we set the arguments <tt>prewhite = F</tt> and <tt>adjust = T</tt> to ensure that the formula <a href="hac-standard-errors.html#eq:nwhac">(2.4)</a> is used and finite sample adjustments are made.</p>
<p>We find that the computed standard errors coincide. Of course, a variance-covariance matrix estimate as computed by <tt>NeweyWest()</tt> can be supplied as the argument <tt>vcov</tt> in <tt>coeftest()</tt> such that HAC <span class="math inline">\(t\)</span>-statistics and <span class="math inline">\(p\)</span>-values are provided by the latter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">example_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span>X)
<span class="kw">coeftest</span>(example_mod, <span class="dt">vcov =</span> NW_VCOV)</code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.542310   0.235423  2.3036  0.02336 *  
## X           0.423305   0.040362 10.4877  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-newey1987">
<p>Newey, W. K., &amp; West, K. D. (1987). A simple, positive semi-definite, heteroskedasticity and autocorrelation consistent covariance matrix. <em>Econometrica</em>, <em>55</em>(3), 703–08.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dynamic-multipliers-and-cumulative-dynamic-multipliers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estimation-of-dynamic-causal-effects-with-strictly-exogeneous-regressors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 1
},
"edit": null,
"download": ["URFITE.pdf"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
